<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script>
  async function analisar() {
    const fileInput = document.getElementById('fileInput');
    const file = fileInput.files[0];
    if (!file) return alert('Selecione um arquivo primeiro.');

    const reader = new FileReader();
    reader.onload = async function (e) {
      const data = new Uint8Array(e.target.result);
      const workbook = XLSX.read(data, { type: 'array' });
      const sheet = workbook.Sheets[workbook.SheetNames[0]];
      const json = XLSX.utils.sheet_to_json(sheet);

      // Enviando os dados para o N8N
      try {
        const res = await fetch('https://carloseduardo.app.n8n.cloud/webhook/analista_api', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(json)
        });

        const result = await res.json();
        document.getElementById('pontos_positivos').innerText = result.pontos_positivos;
        document.getElementById('pontos_atencao').innerText = result.pontos_atencao;
        document.getElementById('sugestao').innerText = result.sugestao;
        document.getElementById('resultado').classList.remove('hidden');
      } catch (err) {
        console.error(err);
        alert('Erro ao processar a an√°lise.');
      }
    };

    reader.readAsArrayBuffer(file);
  }
</script>
